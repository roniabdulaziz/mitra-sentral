<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Akun Saya - Sentral</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #f1f3f6;
  padding-bottom: 70px;
}

header {
  background: #1565c0;
  color: #fff;
  padding: 14px;
  text-align: center;
  font-size: 17px;
  font-weight: 600;
}

.container {
  padding: 14px;
}

.card {
  background: #fff;
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  margin-bottom: 14px;
}

.title {
  font-weight: 600;
  margin-bottom: 10px;
}

/* MUTASI */
.mutasi-item {
  border-bottom: 1px solid #eee;
  padding: 10px 0;
  font-size: 14px;
}

.mutasi-item:last-child {
  border-bottom: none;
}

.mutasi-nominal {
  font-weight: 700;
  color: #2e7d32;
}

.mutasi-meta {
  font-size: 12px;
  color: #666;
  margin-top: 2px;
}

.empty {
  text-align: center;
  color: #777;
  font-size: 14px;
  padding: 20px 0;
}

/* PAGINATION */
.pagination {
  display: flex;
  justify-content: space-between;
  margin-top: 12px;
}

.pagination button {
  padding: 8px 14px;
  border: none;
  border-radius: 8px;
  background: #1565c0;
  color: #fff;
  font-size: 13px;
}

.pagination button:disabled {
  opacity: 0.5;
}

/* LOGOUT */
.logout {
  background: #c62828;
  color: #fff;
  border: none;
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
}
</style>
</head>

<body>

<header>AKUN SAYA</header>

<div class="container">

  <!-- INFO AKUN -->
  <div class="card">
    <div><strong>Nama</strong></div>
    <div id="namaUser">-</div>

    <div style="margin-top:10px;"><strong>Role</strong></div>
    <div id="roleUser">-</div>
  </div>

  <!-- MUTASI ISI SALDO -->
  <div class="card">
    <div class="title">Mutasi Isi Saldo (7 Hari Terakhir)</div>

    <div id="mutasiList"></div>

    <div class="pagination">
      <button id="prevBtn">Sebelumnya</button>
      <button id="nextBtn">Berikutnya</button>
    </div>
  </div>

  <!-- LOGOUT -->
  <div class="card">
    <button class="logout" onclick="logout()">Logout</button>
  </div>

</div>

<!-- ðŸ” GUARD -->
<script src="guard.js"></script>

<script>
/* INFO USER */
document.getElementById("namaUser").textContent =
  localStorage.getItem("member_nama") || "-";

document.getElementById("roleUser").textContent =
  localStorage.getItem("member_role") || "-";

/* ====== MUTASI (AUTO CLEAN 7 HARI) ====== */
const MAX_DAYS = 7;
const now = new Date().getTime();

// ambil data
let rawData = JSON.parse(localStorage.getItem("riwayat_deposit") || "[]");

// filter 7 hari terakhir
rawData = rawData.filter(item => {
  const waktu = new Date(item.tanggal).getTime();
  return (now - waktu) <= MAX_DAYS * 24 * 60 * 60 * 1000;
});

// simpan ulang (hapus otomatis yang lama)
localStorage.setItem("riwayat_deposit", JSON.stringify(rawData));

// urutkan terbaru
const data = rawData.reverse();

/* PAGINATION */
const perPage = 5;
let currentPage = 1;

const list = document.getElementById("mutasiList");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");

function render() {
  list.innerHTML = "";

  if (data.length === 0) {
    list.innerHTML = `<div class="empty">Belum ada mutasi isi saldo</div>`;
    prevBtn.disabled = true;
    nextBtn.disabled = true;
    return;
  }

  const start = (currentPage - 1) * perPage;
  const end = start + perPage;
  const pageData = data.slice(start, end);

  pageData.forEach(item => {
    list.innerHTML += `
      <div class="mutasi-item">
        <div class="mutasi-nominal">
          + Rp${Number(item.nominal).toLocaleString("id-ID")}
        </div>
        <div class="mutasi-meta">
          ${item.metode} â€¢ ${item.tanggal}
        </div>
      </div>
    `;
  });

  prevBtn.disabled = currentPage === 1;
  nextBtn.disabled = end >= data.length;
}

prevBtn.onclick = () => {
  if (currentPage > 1) {
    currentPage--;
    render();
  }
};

nextBtn.onclick = () => {
  if (currentPage * perPage < data.length) {
    currentPage++;
    render();
  }
};

render();

/* LOGOUT */
function logout() {
  localStorage.clear();
  window.location.href = "/";
}
</script>

</body>
</html>
